02. 문서 데이터베이스
====

> 문서를 어떻게 컬렉션으로 묶을 것인가?

## 개요

* 문서 : 키-값 쌍으로 이루어진 집합
* 컬렉션 : 문서들의 집합
  * 같은 엔티티 타입으로 된 문서를 저장해야 함
* 엔티티 : 도메인과 유사한 느낌..

### 장점

* 문서의 구조를 유연하게 만들 수 있다. (문서별로 속성 구조를 다르게 할 수 있기 때문)

### 설계

* 문서 유형 (엔티티)의 추상화 수준을 너무 높게 잡으면 좋지 않다
  * type 의 역할을 하는 속성이 생기기 시작하고 필터를 자주 적용하게 된다면 엔티티를 나눠야 하지 않을지 의심해봐라
* 컬렉션의 크기, 인덱스, 중복을 제거한 문서 고유의 개수에 따라 인덱스를 사용하는 것보다 전체 문서 컬렉션을 스캔하는 것이 빠를 수 있다.

* 앱단 코드에서 높은 수준의 분기처리가 필요하다면 컬렉션을 분리할 필요가 있다는 신호이다.
* 엔터티를 빈번하게 aggregate 하거나 공유하는 코드가 늘어날때에는 문서 서브타입을 사용하라.
  * 집계가 필요하다면 동일 컬렉션에 있는게 맞다!
* 명시적으로 스키마를 정의하지 말자 : 다형적 (polymorphic) 스키마
* 단일 오퍼레이션을 여러개 반복하는 것 보다는 일괄 작업을 사용하자.
  * MongoDB 의 일괄 작업 제한 크기 : 1000개의 오퍼레이션까지... [하지만!](https://jira.mongodb.org/browse/DOCS-3603)

